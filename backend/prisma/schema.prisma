// =============================
// PRISMA CONFIG
// =============================
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =============================
// ENUMS
// =============================
enum RW {
  RW4
  RW5
}

enum JenisFase {
  PENETASAN
  PEMBESARAN
  PANEN
}

// =============================
// USER MODEL
// =============================
model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  password  String
  rw        RW
  createdAt DateTime  @default(now())

  siklus    Siklus[]
  pencacahan pencacahan[]
  notifikasi Notifikasi[]
}

// =============================
// SIKLUS MODEL
// =============================
model Siklus {
  id           Int       @id @default(autoincrement())
  tanggalMulai DateTime
  jumlahTelur  Int
  mediaTelur   String
  catatan      String?
  createdAt    DateTime  @default(now())

  // Relasi ke User
  userId Int
  user   User @relation(fields: [userId], references: [id])

  // Relasi ke fase-fase
  fase   Fase[]
}


// =============================
// FASE MODEL
// =============================
model Fase {
  id            Int        @id @default(autoincrement())
  jenis         JenisFase
  tanggal       DateTime

  // Field opsional, tergantung jenis fase
  jumlahTelur   Int?
  jumlahMakanan Float?
  keterangan    String?

  createdAt     DateTime   @default(now())

  // Relasi ke Siklus
  siklusId Int
  siklus   Siklus @relation(fields: [siklusId], references: [id])

  // Relasi Prediksi Panen (hanya untuk fase PANEN)
  prediksiPanen PrediksiPanen?
}


// =============================
// PREDIKSI PANEN MODEL
// =============================
model PrediksiPanen {
  id              Int      @id @default(autoincrement())
  hasilGram       Float
  hasilKg         Float
  conversionRate  Float
  conversionLabel String

  roiEstimate     Float
  estimatedValue  Float
  feedCost        Float
  createdAt       DateTime @default(now())

  // Relasi ke Fase
  faseId Int @unique
  fase   Fase @relation(fields: [faseId], references: [id])
}

model TokenBlacklist {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  createdAt DateTime @default(now())
}

model pencacahan {
  id           Int      @id @default(autoincrement())
  tanggalWaktu DateTime
  totalSampah  Float
  catatan      String?
  userId       Int
  createdAt    DateTime @default(now())

  user         User     @relation(fields: [userId], references: [id])
}

// ================================
// NOTIFIKASI MODEL
// ================================
model Notifikasi {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  type      String      // info, warning, success
  createdAt DateTime    @default(now())
  isRead    Boolean     @default(false)

  // Relasi ke User
  user      User        @relation(fields: [userId], references: [id])
}

// ================================
// AI RECOMMENDATION CACHE
// ================================
model AIRecommendationCache {
  id             Int      @id @default(autoincrement())
  userId         Int
  dataHash       String   // Hash of aggregated data to detect changes
  recommendation String   @db.Text
  createdAt      DateTime @default(now())

  @@index([userId, dataHash])
}
